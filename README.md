# 加密壳

### 开发环境：
Win10 VisualStudio2010 Win32SDK 多字节集编码 x86

### 原理：
1.打包程序：在壳源程序中新增加一个节，这个节用来存放加密后的被保护程序的二进制数据。生成新的exe文件。

2.新生成的exe：这个程序首先把自身最后一个节中的数据抽取出来，进行解密。以挂起方式创建一个自身傀儡进程，获取线程上下文，卸载傀儡进程的内存，在傀儡进程空间分配一块内存(大小为受保护程序的SizeOfImage)，将解密出来的数据写入这个新分配出来的空间。判断一下分配出来的地址和受保护程序的基址是否一致，如果不一致就要修复重定位表，如果受保护程序没有重定位表，程序退出。如果程序继续运行，修正运行环境的基址(新分配内存首地址)和入口地址(受保护程序的OEP)，恢复傀儡线程的主线程。

### 演示：

#### 打包：
![加密壳-打包](https://i.loli.net/2021/05/13/pdiDCzrMG1eh7To.png)

#### 加密后对比：
![加密壳-对比](https://i.loli.net/2021/05/13/mOruxC4T7DRnFJg.png)

#### 加密后运行：
![加密壳-运行1](https://i.loli.net/2021/05/13/pdiDCzrMG1eh7To.png)

![加密壳-运行2](https://i.loli.net/2021/05/13/rXFIQOeSKAucTih.png)
